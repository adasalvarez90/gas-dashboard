<ion-header class="glass-header">
	<ion-toolbar>
		<ion-buttons slot="start">
			<ion-back-button defaultHref="dashboard/contracts"></ion-back-button>
		</ion-buttons>

		<ion-title>
			{{ contract ? 'Editar contrato' : 'Nuevo contrato' }}
		</ion-title>

		<ion-buttons slot="end">
			<ion-button class="save-btn" color="success" [disabled]="!form?.valid"
				(click)="contract ? update() : create()">
				<ion-icon slot="start" name="save"></ion-icon>
				Guardar
			</ion-button>

			@if (contract) {
			<ion-button fill="clear" color="danger" (click)="remove()">
				<ion-icon slot="icon-only" name="trash"></ion-icon>
			</ion-button>
			}
		</ion-buttons>
	</ion-toolbar>
</ion-header>


<ion-content class="contract-manage">
	<ion-grid fixed>
		<ion-row>
			<ion-col size="12">
				<form [formGroup]="form">

					<!-- PERFIL DEL CONTRATO -->
					<div class="contract-hero">
						<div class="avatar">
							{{ (selectedAdvisorName || '?')[0] }}
						</div>

						<div class="hero-info">
							<div class="title">
								{{ selectedAdvisorName || 'Selecciona consultora' }}
							</div>
							<div class="subtitle">
								{{ form.get('investor')?.value || 'Inversionista' }}
							</div>
						</div>

						<ion-toggle color="success" formControlName="signed">
							Firmado
						</ion-toggle>
					</div>

					<!-- INFORMACIN GENERAL -->
					<div class="section">
						<div class="section-title">Informaci贸n general</div>

						<div class="grid-2">
							<ion-item lines="none">
								<ion-label position="stacked">Consultora</ion-label>
								<ion-select formControlName="advisorUid" interface="popover">
									@for (advisor of advisors$ | async; track advisor.uid) {
									<ion-select-option [value]="advisor.uid">
										{{ advisor.name }}
									</ion-select-option>
									}
								</ion-select>
							</ion-item>

							<ion-item lines="none">
								<ion-label position="stacked">Inversionista</ion-label>
								<ion-input formControlName="investor"></ion-input>
							</ion-item>

							<ion-item lines="none">
								<ion-label position="stacked">Correo</ion-label>
								<ion-input type="email" formControlName="email"></ion-input>
							</ion-item>

							<ion-item lines="none">
								<ion-label position="stacked">Cuenta cliente</ion-label>
								<ion-input formControlName="clientAccount"></ion-input>
							</ion-item>
						</div>

						<!--  NUEVO: SOURCE -->
						<div class="source-wrapper">
							<div class="source-title">Origen de inversi贸n</div>

							<div class="source-grid">

								@for (s of sources; track s.value) {
								<div class="source-option" [class.active]="form.get('source')?.value === s.value"
									(click)="form.patchValue({ source: s.value })">
									<div class="source-label">
										{{ s.label }}
									</div>
								</div>
								}

							</div>
						</div>

					</div>

					<!-- DATOS FINANCIEROS -->
					<div class="section primary">
						<div class="section-title">Datos financieros</div>

						<div class="grid-4">
							<ion-item lines="none">
								<ion-label position="stacked">Capital (MXN)</ion-label>
								<ion-input type="number" formControlName="capitalMXN"></ion-input>
							</ion-item>

							<ion-item lines="none">
								<ion-label position="stacked">Rendimiento %</ion-label>
								<ion-input type="number" formControlName="yieldPercent"></ion-input>
							</ion-item>

							<ion-item lines="none">
								<ion-label position="stacked">Liquidez</ion-label>
								<ion-input type="number" formControlName="liquidity"></ion-input>
							</ion-item>

							<ion-item lines="none">
								<ion-label position="stacked">Plazo (meses)</ion-label>
								<ion-input type="number" formControlName="term"></ion-input>
							</ion-item>
						</div>
					</div>

					<!-- CONDICIONES -->
					<div class="section">
						<div class="section-title">Condiciones</div>

						<div class="grid-2">
							<ion-item lines="none">
								<ion-label position="stacked">Periodicidad</ion-label>
								<ion-input formControlName="yieldFrequency"></ion-input>
							</ion-item>

							<ion-item lines="none">
								<ion-label position="stacked">Pagos</ion-label>
								<ion-input formControlName="payments"></ion-input>
							</ion-item>

							<ion-item lines="none">
								<ion-label position="stacked">Estado de cuenta</ion-label>
								<ion-input formControlName="accountStatus"></ion-input>
							</ion-item>

							<ion-item lines="none">
								<ion-label position="stacked">Esquema</ion-label>
								<ion-input formControlName="scheme"></ion-input>
							</ion-item>
						</div>
					</div>

					<!-- FIRMA -->
					<div class="section success">
						<div class="section-title">Informaci贸n de firma</div>
						<div class="grid-3">
							<ion-item lines="none">
								<ion-label position="stacked">Fecha de firma</ion-label>
								<ion-input type="text" formControlName="signature"></ion-input>
							</ion-item>

							<ion-item lines="none">
								<ion-label position="stacked">Fecha de deposito</ion-label>
								<ion-input type="text" formControlName="deposit"></ion-input>
							</ion-item>

							<ion-item lines="none">
								<ion-label position="stacked">Cuenta de deposito</ion-label>
								<ion-input type="text" formControlName="depositAccount"></ion-input>
							</ion-item>
						</div>
					</div>

					<!-- DOCUMENTOS -->
					<div class="section">
						<div class="section-title">Documentaci贸n</div>

						<ion-item lines="none">
							<ion-checkbox slot="start" formControlName="docs"></ion-checkbox>
							<ion-label>Documentaci贸n completa</ion-label>
						</ion-item>

						<ion-item lines="none">
							<ion-label position="stacked">Comentarios</ion-label>
							<ion-textarea formControlName="docsComments"></ion-textarea>
						</ion-item>
					</div>

					<!-- BENEFICIARIOS -->
					<div class="section warning">
						<div class="section-title">Beneficiarios</div>
						<ion-textarea formControlName="beneficiaries"></ion-textarea>
					</div>

				</form>
			</ion-col>
		</ion-row>
	</ion-grid>
</ion-content>