@if ((contract$ | async); as contract) {

<ion-header class="modal-header">
	<ion-toolbar>
		<ion-title>Contrato</ion-title>

		<ion-buttons slot="end">
			<ion-button (click)="toggleSign(contract)">
				<ion-icon slot="icon-only" [color]="contract.signed ? 'success' : 'medium'"
					[name]="contract.signed ? 'checkbox' : 'square-outline'">
				</ion-icon>
			</ion-button>

			<ion-button (click)="edit()">
				<ion-icon slot="icon-only" name="create"></ion-icon>
			</ion-button>

			<ion-button (click)="close()">
				<ion-icon slot="icon-only" name="close-outline"></ion-icon>
			</ion-button>
		</ion-buttons>
	</ion-toolbar>
</ion-header>

<ion-content class="contract-modal">

	<!-- FINANCIAL HEADER -->
	<div class="financial-header">
		<div class="amount">
			{{ contract.capitalMXN | currency:'MXN':'symbol':'1.0-0' }}
		</div>

		<div class="meta-line">
			<span class="status" [class.active]="contract.accountStatus === 'active'"
				[class.pending]="contract.accountStatus !== 'active'">
				{{ contract.accountStatus | titlecase }}
			</span>

			<span class="tag scheme">{{ contract.scheme }}</span>

			@if (contract.signed) {
			<span class="tag signed">Firmado</span>
			}
		</div>
	</div>

	<!-- PARTICIPANTES -->
	@if ((advisorsDic$ | async); as advisorsDic) {
	<div class="card">
		<div class="card-title">Participantes</div>

		<div class="info-row">
			<span class="label">Inversionista</span>
			<span class="value">{{ contract.investor }}</span>
		</div>

		<div class="info-row">
			<span class="label">Asesora</span>
			<span class="value">
				{{ advisorsDic[contract.roles.consultant]?.name || 'Sin asignar' }}
			</span>
		</div>

		<div class="info-row">
			<span class="label">Origen</span>
			<span class="value">
				{{ contract.source === 'COMUNIDAD' ? 'Comunidad' :
				contract.source === 'RED_CALIDA' ? 'Red Cálida' :
				contract.source === 'DINERO_PROPIO' ? 'Dinero propio' :
				contract.source === 'REFERIDORA' ? 'Referidora' : 'Sin asignar' }}
			</span>
		</div>
	</div>

	<div class="card">
		<div class="card-title">Otros roles</div>

		<div class="info-row">
			<span class="label">Gerente</span>
			<span class="value">
				{{ advisorsDic[contract.roles.manager]?.name || 'Sin asignar' }}
			</span>
		</div>

		<div class="info-row">
			<span class="label">KAM</span>
			<span class="value">
				{{ advisorsDic[contract.roles.kam]?.name || 'Sin asignar' }}
			</span>
		</div>

		<div class="info-row">
			<span class="label">Dirección de Ventas</span>
			<span class="value">
				{{ advisorsDic[contract.roles.salesDirector]?.name || 'Sin asignar' }}
			</span>
		</div>

		<div class="info-row">
			<span class="label">Equipo Operativo</span>
			<span class="value">
				{{ advisorsDic[contract.roles.operations]?.name || 'Sin asignar' }}
			</span>
		</div>

		<div class="info-row">
			<span class="label">CEO</span>
			<span class="value">
				{{ advisorsDic[contract.roles.ceo]?.name || 'Sin asignar' }}
			</span>
		</div>

		@if(contract.roles.referral) {
		<div class="info-row">
			<span class="label">Referidora</span>
			<span class="value">
				{{ advisorsDic[contract.roles.referral]?.name || 'Sin asignar' }}
			</span>
		</div>
		}
	</div>
	}

	<!-- FIRMA -->
	<div class="card">
		<div class="card-title">Firma del contrato</div>

		<div class="info-row">
			<span class="label">Firma</span>
			<span class="value">{{ contract.signature }}</span>
		</div>

		<div class="info-row">
			<span class="label">Depósito</span>
			<span class="value">{{ contract.deposit }}</span>
		</div>
	</div>

	<!-- CAPITAL Y RENDIMIENTO -->
	<div class="card">
		<div class="card-title">Capital & Rendimiento</div>

		<div class="metrics">
			<div>
				<span class="label">Capital</span>
				<strong class="highlight">
					${{ contract.capitalMXN | number:'1.2-2' }} MXN
				</strong>
			</div>

			<div>
				<span class="label">Rendimiento</span>
				<strong>{{ contract.yieldPercent }}%</strong>
			</div>

			<div>
				<span class="label">Liquidez</span>
				<strong>{{ contract.liquidity }}%</strong>
			</div>
		</div>
	</div>

	<!-- PLAZO Y PAGOS -->
	<div class="card">
		<div class="card-title">Plazo & Pagos</div>

		<div class="metrics">
			<div>
				<span class="label">Plazo</span>
				<strong>{{ contract.term }} meses</strong>
			</div>

			<div>
				<span class="label">Periodicidad</span>
				<strong>{{ contract.yieldFrequency }}</strong>
			</div>

			<div>
				<span class="label">Pagos</span>
				<strong>{{ contract.payments }}</strong>
			</div>
		</div>
	</div>

	<!-- CUENTAS -->
	<div class="card">
		<div class="card-title">Cuentas</div>

		<div class="info-row">
			<span class="label">Cuenta depósito</span>
			<span class="value">{{ contract.depositAccount }}</span>
		</div>

		<div class="info-row">
			<span class="label">Cuenta cliente</span>
			<span class="value">{{ contract.clientAccount }}</span>
		</div>
	</div>

	<!-- DOCUMENTACIÓN -->
	<div class="card">
		<div class="card-title">Documentación</div>

		<div class="info-row">
			<span class="label">Documentos completos</span>
			<span class="status" [class.active]="contract.docs" [class.inactive]="!contract.docs">
				{{ contract.docs ? 'Sí' : 'No' }}
			</span>
		</div>

		@if (contract.docsComments) {
		<div class="note">
			{{ contract.docsComments }}
		</div>
		}
	</div>

	<!-- BENEFICIARIOS -->
	@if (contract.beneficiaries) {
	<div class="card">
		<div class="card-title">Beneficiarios</div>
		<p class="text-block">
			{{ contract.beneficiaries }}
		</p>
	</div>
	}

	<!-- CONTACTO -->
	<div class="card">
		<div class="card-title">Contacto</div>

		<div class="info-row">
			<span class="label">Email</span>
			<span class="value">{{ contract.email }}</span>
		</div>
	</div>

</ion-content>
}